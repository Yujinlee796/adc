<!DOCTYPE html>
<html>
    <head>
        <title>로그인 ｜ 핏투게더</title>
        
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha256-3edrmyuQ0w65f8gfBsqowzjJe2iM6n0nKciPUp8y+7E=" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
            
            
            <!-- MATERIAL DESIGN ICONIC FONT -->
        <link rel="stylesheet" href="design_files/fonts/material-design-iconic-font/css/material-design-iconic-font.min.css">
                
            <!-- STYLE CSS -->
        <link rel="stylesheet" href="design_files/css/styleSignin.css">

            <!-- The core Firebase JS SDK is always required and must be listed first -->
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-app.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-auth.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-database.js"></script>
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-storage.js"></script>
        <!--연습-->
        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-messaging.js"></script>

        <script src="https://www.gstatic.com/firebasejs/7.17.1/firebase-analytics.js"></script>

    </head>

    <body>
        <script type="text/javascript">
            function deviceKind() {
          
              var flag;
          //모바일 Device종류(윈도우 폰은 앞으로 나오지 않기 때문에 빼도 무방하나 아직 쓰는 사람이 존재하기에..)
          
              var mobileFlag = /Mobile|iP(hone|od)|Windows (CE|Phone)|Minimo|Opera M(obi|ini)|BlackBerry|Nokia/;
              //모바일일경우
          
              if (navigator.userAgent.match(mobileFlag) && !navigator.userAgent.match(/iPad/)) {
          
                  flag = "Mobile";
          
              }
                  //모바일 Device와 Android가 포함이 안되어 있을 경우
          
              else if (navigator.userAgent.match(/iPad|Android/)) {
          
                  flag = "Tablet";
          
              }
                  //그 외의 경우 모두 테블릿
          
              else {
          
                  flag = "PC(Mobile, Tablet 외)";
          
              }
              console.log(flag);
              if (flag === "PC(Mobile, Tablet 외)") {
                location.href = "../../login/signin.html";
              }

              else if (flag === "Tablet") {
                location.href = "../../login/signin.html";
              }
            };
            deviceKind();
          
          
          </script>
          <!--
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
크롬이나 엣지 아니면 out이야
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
-->
<script type="text/javascript">
    /* 
     * http://tonks.tistory.com/107 
     */ 
    
  
    function isBrowserCheck(){
  
      var agent = navigator.userAgent.toLowerCase();
      var browserName;
      var word; 
      var info = {  name: "N/A" , version: -1  }; 
  
      if ( navigator.appName == "Microsoft Internet Explorer" ){    // IE old version ( IE 10 or Lower ) 
              word = "msie "; 
      } 
      else if ( agent.search( "trident" ) > -1 ) word = "trident/.*rv:";    // IE 11 
      else if ( agent.search( "edge/" ) > -1  ) word = "edge/";        // Microsoft Edge 
      else  { 
        if (agent.indexOf("chrome") != -1) {
            browserName = "Chrome";
        }
        else {
            browserName = "cannotAccess"
        }
      } 
  
  
      var reg = new RegExp( word + "([0-9]{1,})(\\.{0,}[0-9]{0,1})" ); 
  
      if (  reg.exec( agent ) != null  ){ 
  
              info.version = parseFloat( RegExp.$1 + RegExp.$2 ); 
  
              info.name = ( word == "edge/" ) ? "Edge" : "IE"; 
              browserName = info.name;
      } 
  
      
      console.log(browserName);
  
      if (browserName === "Chrome" || browserName === "Edge") {
  
      }
  
      else {
        location.href = "error/browserError.html";
      }
      };
      
      isBrowserCheck();
  
    </script>
        <div id="loading">
            <img id="loadingImg" src="design_files/images/loadingImg.gif">
        </div>    
        
            
            <div class="inner">
                <h1 style="font-size: 70px; font-weight: bolder; text-align: center; margin-bottom: 150px; margin-top: 150px;">핏투게더</h1><br>
                
                <form action="">
                    
                    <h3>로그인</h3>
                    <div class="form-wrapper">
                        <input id="email" type="email" placeholder="Email" class="form-control" style="font-size: 30px;">
                        
                    </div>
                    <span id="confirmEmailResult" style="position: relative; bottom: 40px;z-index: 3;font-size: 30px;"></span>
                    <div class="form-wrapper" style="margin-bottom: 0;">
                        <input id="password" type="password" placeholder="비밀번호" class="form-control" style="margin-bottom: 100px; font-size: 30px;">
                        
                    </div>
                    <span id="confirmPasswordResult" style="position: relative; bottom: 90px;z-index: 3; font-size: 30px;"></span>
                    <div class="form-group container-login100-form-btn">
                        <button id="btn-login" type="button">
                            로그인
                            <i class="zmdi zmdi-arrow-right"></i>
                        </button>
                    </div>

                    <div class="w-full text-center p-t-27 p-b-239">
                        <a href="forgetPassword.html" class="text-dark" style="font-size: 30px;">
                            Email / 비밀번호
                        </a>
                        <span class="text-muted" style="font-size: 30px;">
                            를 잊어버리셨나요?
                        </span><br>
                        <span id="plzFillin" style="font-size: 30px;"></span>
                        <div class="w-full text-center" style="margin-top: 120px;margin-bottom: 150px;">
                            <a href="signUp.html" class="text-dark" style="font-size: 30px;">
                                계정이 없으신가요?
                            </a>
                        </div>
                    </div>
                    
                </form>
            </div>
        </div>
 

        <!--연습
        로그인 화면 및 가입화면 영역
        <div id="dvAuth">
            <div id="dvLogin">
                <h5>로그인</h5>
                <div id="dvSocial">
                    <ul class="btnGroup">
                        <li id="liGoogleBtn" class="waves-effect waves-teal btn-flat"><i></i>구글 계정으로 가입 및 로그인</li>
                        <li id="liFacebookBtn" class="waves-effect waves-teal btn-flat"><i></i>페이스북 계정으로 가입 및 로그인</li>
                    </ul>
                    <em class="or">or</em>
                </div>
                <div id="dvEmail">
                    <input type="email" id="userName" name="userName" class="input-text" placeholder="이메일 아이디">
                    <input type="password" id="password" name="password" class="input-text" maxlength="17" placeholder="비밀번호">
                    <ul class="btnGroup">
                        <li id="liEmailBtn" class="waves-effect waves-teal btn-flat">이메일으로 로그인</li>
                    </ul>
                    <ul class="btnGroup">
                        <li id="liEmailJoin" class="waves-effect waves-teal btn-flat">이메일으로 가입</li>
                    </ul>
                </div>
            </div>
            <div id="dvJoin">
                <h5>이메일 가입</h5>
                <input type="text" id="joinUserName" name="userName" class="input-text" placeholder="이름">
                <input type="email" id="joinUserEmail" name="userName" class="input-text" placeholder="이메일 아이디">
                <input type="password" id="joinPassword" name="password" class="input-text" maxlength="17" placeholder="비밀번호">
                <input type="password" id="joinRePassword" class="input-text" maxlength="17" placeholder="비밀번호 확인">
                <ul class="btnGroup">
                    <li id="liEmailJoinSubmit" class="waves-effect waves-teal btn-flat">이메일으로 가입</li>
                </ul>
            </div>
        </div>-->


        <script src="js/login.js"></script>

        <!--연습
        <script>
            /**
           *  FirebaseChat ES5 클래스
           */
          function FirebaseChat(){
              this.init();
              this.initEvent();
          }

          /**
           * 초기 필드 변수 할당
           */
          FirebaseChat.prototype.init = function(){
              this.auth = firebase.auth();
              this.liGoogleBtn = document.getElementById('liGoogleBtn');
              this.liFacebookBtn = document.getElementById('liFacebookBtn');
              this.liEmailJoin = document.getElementById('liEmailJoin');
              this.dvLogin  = document.getElementById('dvLogin');
              this.dvJoin = document.getElementById('dvJoin');
              this.liEmailJoinSubmit = document.getElementById('liEmailJoinSubmit');
              this.liEmailBtn = document.getElementById('liEmailBtn');
              this.dvAuth = document.getElementById('dvAuth');
              this.liLogOut = document.getElementById('liLogOut');
          }

          /**
           * 초기 이벤트 바인딩
           */
          FirebaseChat.prototype.initEvent = function(){
              this.liGoogleBtn.addEventListener('click', this.onGoogleBtnClick.bind(this));
              this.auth.onAuthStateChanged(this.onAuthChange.bind(this));
              this.liFacebookBtn.addEventListener('click', this.onFacebookBtnClick.bind(this));
              this.liEmailJoin.addEventListener('click', this.displayEmailJoin.bind(this));
              this.liEmailJoinSubmit.addEventListener('click', this.createEmailUser.bind(this));
              this.liEmailBtn.addEventListener('click', this.onEmailBtnClick.bind(this));
              this.liLogOut.addEventListener('click', this.logOut.bind(this));
          }

          /**
           * 로그아웃
           */
          FirebaseChat.prototype.logOut = function(){
              if(confirm('로그아웃 하시겠습니까?')){
                  if(this.database){
                      this.database.goOffline(); // 데이터 베이스를 명시적으로 오프라인
                  }
                  this.auth.signOut();
              }
          }

          /**
           * 인증 정보가 변화 되었을 시에 변화
           */
          FirebaseChat.prototype.onAuthChange = function(user){
              if (user) {
                  console.log('user로그인 : ',JSON.stringify(user));
                  this.setLogin();
              } else {
                  console.log('로그아웃');
                  this.setLogOut();
              }
          }

          /**
           *  로그인 후 세팅
           */
          FirebaseChat.prototype.setLogin = function(){
              this.database = firebase.database(); // 인증 받은 후 초기화 하여야 합니다. 필드 변수에 서 할당하면 인증 받기전에 할당이라 에러발생
              this.database.goOnline(); // 데이터베이스를 명시적으로 온라인
              this.dvAuth.style.display = 'none';
          }

          /***
           *  이메일 로그인 버튼 클릭
           */
           FirebaseChat.prototype.onEmailBtnClick = function(){
              var email = document.getElementById('userName').value.trim();
              var password = document.getElementById('password').value.trim();
              if(FirebaseChat.emailCheck(email) && password.length > 0){ // 유효성 체크
                  var cbSignInEmail = function() {
                      return  this.auth.signInWithEmailAndPassword(email, password)
                          .then(function(){
                              console.log('이메일 로그인 성공');
                          })
                          .catch(function(error) {
                              console.error('이메일 로그인 과정 에러', error);
                              switch(error.code){
                                  case "auth/invalid-email":
                                      alert('유효하지 않은 메일입니다');
                                      break;
                                  case "auth/user-disabled":
                                      alert('사용이 정지된 유저 입니다.')
                                      break;
                                  case "auth/user-not-found":
                                      alert('사용자를 찾을 수 없습니다.')
                                      break;
                                  case "auth/wrong-password":
                                      alert("잘못된 패스워드 입니다.");
                                      break;

                              }
                          });
                  }
                  this.auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
                      .then(cbSignInEmail.bind(this));
              }
          }

          /**
           * 이메일로 가입 처리
           */
          FirebaseChat.prototype.createEmailUser = function(){
              var userName = document.getElementById('joinUserName').value.trim();
              var email = document.getElementById('joinUserEmail').value.trim();
              var password = document.getElementById('joinPassword').value.trim();
              var rePassword =document.getElementById('joinRePassword').value.trim();
              // 유효성 검증
              if(this.validateJoinForm(email, password, rePassword)){
                  var cbCreateUserWithEmail = function(user){
                      console.log('이메일 가입 성공 : ', JSON.stringify(user));
                      //프로필 업데이트 - 이메일 가입시 유저이름 파라미터를 보내지 않으므로 가입 성공 후 처리
                      user.updateProfile({
                          displayName: this.userName,
                      }).then(function() {
                          console.log('userName 업데이트 성공')
                      }).catch(function(error) {
                          console.error('userName 업데이트 실패 : ', error );
                      });

                      //인증 메일 발송
                      this.auth.useDeviceLanguage(); // 이메일 기기언어로 세팅
                      user.sendEmailVerification().then(function() {
                          console.log('인증메일 발송 성공')
                      }).catch(function(error) {
                          console.error('인증메일 발송 에러', error);
                      });
                  }
                  var cbAfterPersistence = function(){
                      return this.auth.createUserWithEmailAndPassword(email, password)
                          .then(cbCreateUserWithEmail.bind(this))
                          .catch(function(error) {
                              console.error('이메일 가입시 에러 : ', error);
                              switch(error.code){
                                  case "auth/email-already-in-use":
                                      alert('이미 사용중인 이메일 입니다.');
                                      break;
                                  case "auth/invalid-email":
                                      alert('유효하지 않은 메일입니다');
                                      break;
                                  case "auth/operation-not-allowed":
                                      alert('이메일 가입이 중지되었습니다.');
                                      break;
                                  case "auth/weak-password":
                                      alert("비밀번호를 6자리 이상 필요합니다");
                                      break;

                              }
                          });
                  }

                  this.auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
                      .then(cbAfterPersistence.bind(this))
                      .catch(function(error) {
                          console.error('인증 상태 설정 중 에러 발생' , error);
                      });


              }
          }

          /**
           *  이메일 가입 폼에서 유효성 체크
           */
          FirebaseChat.prototype.validateJoinForm = function(email, password, rePassword){
              //이메일 유효성 체크
              if(!FirebaseChat.emailCheck(email)){
                  alert("이메일 형식에 맞지 않습니다");
                  return false;
              }
              //패스워드 동일 여부 체크
              if(password !== rePassword){
                  alert('패스워드가 동일하지 않습니다');
                  return false
              }

              return true;
          }

          /**
           * 이메일 형식 체크
           */
          FirebaseChat.emailCheck = function(mail){
              if (/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(mail)) {
                  return true;
              }
              return false;
          }


          /**
           * 이메일 가입 폼 표시
           */
          FirebaseChat.prototype.displayEmailJoin = function(){
              this.dvLogin.style.display='none';
              this.dvJoin.style.display='block';
          }

          /**
           * 페이스북 로그인 버튼 클릭
           */
          FirebaseChat.prototype.onFacebookBtnClick = function(){
              var facebookProvider = new firebase.auth.FacebookAuthProvider();
              this.auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
                  .then(this.signInWithPopup.bind(this, facebookProvider))
                  .catch(function(error) {
                      console.error('인증 상태 설정 중 에러 발생' , error);
                  });
          }

          /**
           * Google 로그인 버튼 클릭
           */
          FirebaseChat.prototype.onGoogleBtnClick = function(){
              var googleProvider = new firebase.auth.GoogleAuthProvider();
              this.auth.setPersistence(firebase.auth.Auth.Persistence.SESSION)
                  .then(this.signInWithPopup.bind(this, googleProvider))
                  .catch(function(error) {
                      console.error('인증 상태 설정 중 에러 발생' , error);
                  });
          }

          /**
           * 지속성 설정 후 sign-in 팝업창
           */
          FirebaseChat.prototype.signInWithPopup = function(provider) {
              return  this.auth.signInWithPopup(provider).then(function(result) {
                  console.log('로그인 성공')
              }).catch(function(error) {
                  alert('로그인에 실패하였습니다');
                  console.error('로그인 에러',error);
              });
          }
        </script>-->

        <script>
            firebase.auth().onAuthStateChanged(function(user)
            {
                if(user)
                {
                    window.location.href = "../main/mainPage.html";
                }
            });
        </script>
    </body>
</html>